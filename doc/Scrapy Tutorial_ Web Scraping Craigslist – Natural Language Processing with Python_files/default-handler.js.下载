"use strict";function ResourceLoader(){}function SPForm(t){var e=this,o="//login.sendpulse.com",r="//email.routee.net";window.SPFormRegistry=window.SPFormRegistry||{},e.id=t,e.formSelector="#sp-form-"+e.id,e.$form=jQ(e.formSelector),e.$formMessage=jQ(e.formSelector+" .sp-message"),e.$formOuter=jQ(e.formSelector).parent(".sp-form-outer").length?jQ(e.formSelector).parent(".sp-form-outer"):jQ(e.formSelector).parent(".form-outer"),e.$submitButton=jQ(e.formSelector+" button.sp-button"),e.$closeButton=jQ(e.formSelector+" .sp-btn-close,"+e.formSelector+" .sp-btn-thanks"),e.formHash=e.$form.attr("sp-hash"),e.formType=e.$form.hasClass("sp-form-popup")?"popup":"embed",e.formType=e.$form.hasClass("sp-form-fixed")?"fixed":e.formType,e.inputs={},e.inputsSelector=e.formSelector+" .sp-element-container :input",e.language=e.$form.attr("sp-lang"),e.preparedData={},e.sent=!1,e.showOptions=function(){var t=e.$form.attr("sp-show-options")?JSON.parse(decodeURIComponent(e.$form.attr("sp-show-options"))):{};return t.maDomain&&(o="//"+t.maDomain),t.amd&&(o=r),void 0===t.urlFilter&&(t.urlFilter=!1),void 0===t.urlFilterConditions&&(t.urlFilterConditions=[]),t}(),e.submitURL=function(){return o+"/members/forms/jsonp-submit"}(),e.history=new SPHistory(e.formHash),e.previewMode=function(){var t=["forms.sendpulse.com","forms.sendpulse.local","forms.routee.net"];return e.showOptions.formsDomain&&t.push(e.showOptions.formsDomain),-1!==t.indexOf(window.location.hostname)}(),e.statAgent=new SPStatAgent(o,e.id),e.valid=!0,e.ipInfo={},e.urlFilter=new SPURLFilter({active:!e.previewMode&&e.showOptions.urlFilter,conditions:e.showOptions.urlFilterConditions}),e.init()}function SPHistory(t){var e=this;e.formHash=t,e.all=e.raise()}function SPStatAgent(t,e){function o(t,e){new Fingerprint2({excludeJsFonts:!0}).get(function(e,o){t({result:e,components:o})})}var r=this;r.formId=e,r.targetUrl=t+"/members/forms/stat",r.fp=0,r.ready=new Promise(o).then(function(t){return r.fp=t.result,t})}function SPURLFilter(t){function e(t){return t.replace(/((^\w+:|^)\/\/)|(\/$)/g,"")}var o=this;o.config={active:!1,conditions:[],url:e(window.location.href)},o.config=jQ.extend(o.config,t),o.rules=function(t){var o={show:"",hide:""};return t.forEach(function(t){var r=e(t.token);switch(t.clause){case"contains":o[t.force]+=r+"|";break;case"equal":o[t.force]+="^"+r+"$|";break;case"begins":o[t.force]+="^"+r+"|";break;case"ends":o[t.force]+=r+"$|"}}),o}(o.config.conditions)}!function(t){function e(e){new Promise(function(e,o){void 0===t.jQuery||Boolean(!t.jQuery.fn.on)?ResourceLoader.loadScript("//ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js",function(){t.jQ=t.jQuery}).then(function(){e()}):(t.jQ=t.jQuery,e())}).then(e)}function o(){var t=jQ(".sp-form-outer").length?".sp-form-outer":".form-outer",e=[],o=jQ('div.sp-form [name="sform[phone]"]'),s=jQ('div[class*=" sp-animation-"]'),i=r();try{n="//"+jQ(t).next("script").attr("src").split("/")[2]}catch(t){n="//login.sendpulse.com"}new Promise(function(t,r){o.length>0&&(e.push(ResourceLoader.loadCss("//cdnjs.cloudflare.com/ajax/libs/intl-tel-input/9.2.4/css/intlTelInput.css")),e.push(ResourceLoader.loadScript("//cdnjs.cloudflare.com/ajax/libs/intl-tel-input/9.2.4/js/intlTelInput.min.js")),e.push(ResourceLoader.loadScript("//cdnjs.cloudflare.com/ajax/libs/intl-tel-input/9.2.4/js/utils.js"))),e.push(ResourceLoader.loadScript(n+"/apps/fc3/build/dh-libs.js")),s.length>0&&e.push(ResourceLoader.loadCss(n+"/apps/fc3/build/form-animations.css?1519661373442")),e.push(ResourceLoader.loadScript("//cdnjs.cloudflare.com/ajax/libs/mobile-detect/1.3.6/mobile-detect.min.js")),e.push(ResourceLoader.loadCss(n+"/apps/fc3/build/form-defaults.css?1519661373442")),Promise.all(e).then(function(){t()},function(t){console.error("Necessary scripts have not been loaded:",t)})}).then(function(){for(var t=0,e=i.length;t<e;t++)new SPForm(i[t]).run()})}function r(){var t=jQ("div.sp-form"),e=t.length,o=[];if(!e)throw new Error("SendPulse: Subscription form ID is missing or code is corrupted!");for(var r=0;r<e;r++){var n=Number(jQ(t[r]).attr("sp-id"));if(isNaN(n)||n<1)throw new Error("SendPulse: Subscription form ID is wrong!");o.push(n)}return o}var n="";t.spFormBootstrap=function(){"undefined"!=typeof Promise&&-1!==Promise.toString().indexOf("[native code]")?e(o):ResourceLoader.loadPromisePolyfill(function(){e(o)})},t.addEventListener("load",t.spFormBootstrap,!1)}(window),ResourceLoader.loadScript=function(t,e,o){return new Promise(function(r,n){var s=document.createElement("script");void 0===o&&(o=!1),s.type="text/javascript",s.async=!0,s.src=t+(o?"?t="+(new Date).getTime():""),document.getElementsByTagName("head")[0].appendChild(s),s.readyState?s.onreadystatechange=function(){"loaded"!==s.readyState&&"complete"!==s.readyState||(s.onreadystatechange=null,"function"==typeof e&&e(),r())}:s.onload=function(){"function"==typeof e&&e(),r()},s.onerror=function(){n(new Error("Loading fail! "+t))}})},ResourceLoader.loadCss=function(t,e,o){return new Promise(function(r,n){var s=document.createElement("link");void 0===o&&(o=!1),s.rel="stylesheet",s.media="screen",s.href=t+(o?"?t="+(new Date).getTime():""),document.getElementsByTagName("head")[0].appendChild(s),s.readyState?s.onreadystatechange=function(){"loaded"!==s.readyState&&"complete"!==s.readyState||(s.onreadystatechange=null,"function"==typeof e&&e(),r())}:s.onload=function(){"function"==typeof e&&e(),r()},s.onerror=function(){n(new Error("Loading fail! "+t))}})},ResourceLoader.loadPromisePolyfill=function(t,e){var o="//polyfill.io/v2/polyfill.min.js?flags=gated,always&features=Promise,&rum=0",r=document.createElement("script");void 0===e&&(e=!1),r.type="text/javascript",r.async=!1,r.src=o+(e?"?t="+(new Date).getTime():""),document.getElementsByTagName("head")[0].appendChild(r),r.readyState?r.onreadystatechange=function(){"loaded"!==r.readyState&&"complete"!==r.readyState||(r.onreadystatechange=null,"function"==typeof t&&t())}:r.onload=function(){"function"==typeof t&&t()},r.onerror=function(){throw new Error("Loading fail! "+o)}},SPForm.prototype.init=function(){var t=this;return t.$closeButton.on("click",function(e){t.close(!0)}),t.$submitButton.prop("disabled",!t.valid),jQ(t.inputsSelector).each(function(e,o){var r=jQ(o);r.hideTip=function(){r.hasClass("sp-invalid")&&(this.removeClass("sp-invalid"),this.next(".sp-tip").detach())},r.showTip=function(t){var e=JSON.parse(decodeURIComponent(this.attr("sp-tips")));this.addClass("sp-invalid"),e.hasOwnProperty(t)&&this.after(jQ("<div/>",{class:"sp-tip sp-invalid",html:e[t]}))},r.on("focus",function(){t.hideAllTips()}),"sform[phone]"===r.attr("name")&&r.intlTelInput({initialCountry:"auto",separateDialCode:!0,geoIpLookup:function(e){jQ.get("//ipinfo.io",function(){},"jsonp").always(function(o){t.ipInfo=o;var r=o&&o.country?o.country:"";e(r)})},utilScript:"//cdnjs.cloudflare.com/ajax/libs/intl-tel-input/9.2.4/js/utils.js"}),t.inputs[o.name]=r}),t.$submitButton.off("click").on("click",function(e){t.submit()}),t.$form.on("submit",function(){return t.submit(),!1}),t.previewMode&&(t.$form.removeClass("sp-form-popup"),t.$form.removeClass("sp-form-fixed"),t.$formOuter.removeClass("sp-popup-outer"),t.$closeButton.remove()),t},SPForm.prototype.run=function(){this.show()},SPForm.prototype.hideAllTips=function(){var t=this;for(var e in t.inputs)t.inputs.hasOwnProperty(e)&&t.inputs[e].hasOwnProperty("hideTip")&&t.inputs[e].hideTip()},SPForm.prototype.disableInputs=function(){var t=this;jQ(t.inputsSelector).prop("disabled",!0),t.$submitButton.prop("disabled",!0)},SPForm.prototype.enableInputs=function(){var t=this;jQ(t.inputsSelector).prop("disabled",!1),t.$submitButton.prop("disabled",!1)},SPForm.prototype.close=function(t){var e=this;"embed"!==e.formType&&(e.$formOuter.addClass("sp-hide"),t&&!e.history.getSubmits().length&&e.history.addReject((new Date).getTime()),e.statAgent.registerRefusing())},SPForm.prototype.show=function(){function t(t){t=t||.2,t*=1e3,setTimeout(function(){e.$formOuter.addClass("sp-showing"),setTimeout(function(){e.$formOuter.addClass("sp-show")},200),setTimeout(function(){e.$formOuter.removeClass("sp-showing")},400)},t)}var e=this;if(!(function(){if(e.showOptions.hideOnMobile){return new MobileDetect(window.navigator.userAgent).mobile()}return!1}()||"embed"!==e.formType&&!e.urlFilter.isAllowed()||"embed"!==e.formType&&function(){if("onButtonClick"===e.showOptions.condition)return jQ("[sp-show-form]").on("click",function(){var t=jQ(this).attr("sp-show-form");jQ("#sp-form-"+t).parent(".sp-form-outer").removeClass("sp-force-hide").removeClass("sp-hide").addClass("sp-show"),e.statAgent.registerShow()}),!0}())){if(e.$formOuter.removeClass("sp-force-hide"),e.previewMode)return void t();if("embed"!==e.formType){if(e.history.getSubmits().length)return;if(e.history.getRejects().length>1)return;if(1===e.history.getRejects().length){var o=(new Date).getTime(),r=(o-e.history.getLastShow())/864e5;if(e.showOptions.repeat>0&&r<e.showOptions.repeat)return}"popup"!==e.formType&&"fixed"!==e.formType||(!function(){switch(e.showOptions.condition){case"onEnter":t(e.showOptions.delay);break;case"onScroll":jQ(window).scroll(function(){var o=(jQ(document).height()-jQ(window).height())/100*e.showOptions.scrollTo;jQ(window).scrollTop()>=o&&t()});break;case"onCursorLeave":jQ("body").on("mouseleave",function(){t()});break;case"onClose":jQ(window).on("unload",function(e){e.preventDefault(),t()})}}(),e.statAgent.registerShow())}else e.statAgent.registerShow();e.history.addLastShow()}},SPForm.prototype.validateAll=function(){var t=this;t.valid=!0;for(var e in t.inputs)if(t.inputs.hasOwnProperty(e)&&void 0!==t.inputs[e].attr("sp-type")){var o=t.inputs[e],r=t.validate(o);t.valid=t.valid&&r}return t},SPForm.prototype.validate=function(t){var e=this,o=t.attr("sp-type");if(void 0===o)return!0;"sform[phone]"===t.name&&(o="phone");var r=!0,n=t.val();if(t.hideTip(),t.prop("required"))switch(o){case"checkbox":r=t.prop("checked");break;default:r=""!==n}if(!r)return t.showTip("required"),e.$submitButton.prop("disabled",!1),r;if(t.prop("required")&&""===n)return r=!1,t.showTip("required"),e.$submitButton.prop("disabled",!1),r;if(r&&""!==n)switch(o){case"address":case"date":r=!0;break;case"email":r=function(t){return/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(t)}(n);break;case"phone":t.prop("required")&&(r=function(e){return!!jQ.trim(t.val())&&t.intlTelInput("isValidNumber")}(t))}return r||t.showTip("wrong"),r},SPForm.prototype.cbSubmit=function(t){var e=this;t.hasOwnProperty("html")&&t.hasOwnProperty("status")&&("success"===t.status?(e.$formMessage.addClass("sp-message-success"),e.sent=!0,e.history.addSubmit(),e.$formMessage.html(t.html),e.enableInputs(),e.statAgent.registerSubmit()):"verify"===t.status?(e.sent=!0,e.history.addSubmit(),e.enableInputs(),e.close(),window.location.href="//"+HOST_PRODUCTION+"/forms/recaptcha?hash="+t.form_hash):(e.$formMessage.addClass("sp-message-error"),e.$formMessage.html(t.html),e.enableInputs(),e.statAgent.registerBadSubmit())),e.removeInstanceFromRegistry()},SPForm.prototype.submit=function(){var t=this;if("popup"===t.formType&&t.history.getSubmits().length>1)throw new Error("Form has been submitted twice already. Enough!");t.sent||(t.validateAll(),t.valid&&(t.disableInputs(),t.putInstanceToRegistry(),function(){for(var e in t.inputs)if(t.inputs.hasOwnProperty(e)){var o=t.inputs[e];switch(o.attr("sp-type")){case"phone":t.preparedData[e]=o.intlTelInput("getNumber");break;case"checkbox":o.prop("checked")?t.preparedData[e]=o.val():t.preparedData[e]="no";break;case"radio":t.preparedData[e]=jQ('[name="'+e+'"]:checked').val();break;default:t.preparedData[e]=o.val()}}t.preparedData.sform_lang=t.language,t.preparedData["sform[hash]"]=t.formHash,t.preparedData["sform["+window.btoa("autoSite")+"]"]=window.location.hostname,jQ.isEmptyObject(t.ipInfo)||(t.preparedData["sform["+window.btoa("autoIp")+"]"]=t.ipInfo.ip,t.preparedData["sform["+window.btoa("autoCity")+"]"]=t.ipInfo.city,t.preparedData["sform["+window.btoa("autoRegion")+"]"]=t.ipInfo.region,t.preparedData["sform["+window.btoa("autoCountry")+"]"]=t.ipInfo.country)}(),function(){jQ.ajax({url:t.submitURL+"?callback=?",dataType:"jsonp",data:t.preparedData,jsonpCallback:t.makeCallbackName("cbSubmit")})}()))},SPForm.prototype.makeCallbackName=function(t){return"SPFormRegistry['"+this.formHash+"']."+t},SPForm.prototype.putInstanceToRegistry=function(){var t=this;window.SPFormRegistry[t.formHash]=t},SPForm.prototype.removeInstanceFromRegistry=function(){var t=this;void 0!==window.SPFormRegistry[t.formHash]&&delete window.SPFormRegistry[t.formHash]},SPHistory.prototype.raise=function(){var t=this;if(localStorage[t.formHash])try{return JSON.parse(localStorage.getItem(t.formHash))}catch(t){console.error(t)}return{submits:[],rejects:[],lastShow:0}},SPHistory.prototype.persist=function(){var t=this;localStorage.setItem(t.formHash,JSON.stringify(t.all))},SPHistory.prototype.add=function(t,e){var o=this;switch(e=e||(new Date).getTime(),t){case"submits":case"rejects":o.all[t].push(e);break;case"lastShow":o.all[t]=e}o.persist()},SPHistory.prototype.addSubmit=function(t){this.add("submits",t)},SPHistory.prototype.addReject=function(t){this.add("rejects",t)},SPHistory.prototype.addLastShow=function(t){this.add("lastShow",t)},SPHistory.prototype.get=function(t){var e=this;if(e.all.hasOwnProperty(t))return e.all[t]},SPHistory.prototype.getSubmits=function(){return this.get("submits")},SPHistory.prototype.getRejects=function(){return this.get("rejects")},SPHistory.prototype.getLastShow=function(){return this.get("lastShow")},SPStatAgent.prototype.sendInfo=function(t){var e=this;e.ready.then(function(o){setTimeout(function(){jQ.ajax({url:e.targetUrl,dataType:"jsonp",data:{event:t,formId:e.formId,fp:e.fp},jsonp:!0})})})},SPStatAgent.prototype.registerShow=function(){this.sendInfo("show")},SPStatAgent.prototype.registerSubmit=function(){this.sendInfo("submit")},SPStatAgent.prototype.registerBadSubmit=function(){this.sendInfo("bad_submit")},SPStatAgent.prototype.registerRefusing=function(){this.sendInfo("refusing")},SPURLFilter.prototype.isAllowed=function(){var t=this;return!t.config.active||function(){var e={show:!1,hide:!0},o=0;return $.each(t.rules,function(r,n){n.length>0?(t.rules[r]=new RegExp(n.slice(0,-1),"i"),e[r]=t.rules[r].test(t.config.url)):o+=1}),2===o&&(e.show=!0),e.show+!e.hide}()};
//# sourceMappingURL=default-handler.js.map
